#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define MAX_EVENTOS 100
#define MAX_TAMANHO_NOME_EVENTO 20
#define MAX_TAMANHO_NOME 50
#define MAX_TAMANHO_PASSWORD 20
#define MAX_UTILIZADORES 50
#define MAX_EMAIL 50

typedef struct evento {
    char nomeEv[MAX_TAMANHO_NOME];
    int data;
    char DetalhesEvento [150];
    float preco;
} Evento;

typedef struct pagamento
{
    int dataPagamento;
    int metodoPagamento;
    int montante;
}Pagamento;

typedef struct utilizador
{
    char nome[MAX_TAMANHO_NOME];
    int nif;
    char email[MAX_EMAIL];
    char password[MAX_TAMANHO_PASSWORD];
    int idade;
    int admin;
}Utilizador;

typedef struct inscrição                                                                                                                                                                                                 
{
    Utilizador utilizador;
    int numeroDoEvento;
    Pagamento pagamento;
}Inscrição;


Evento eventos[MAX_EVENTOS];
int numEvents = 0;

void registarUtilizador(Utilizador utilizadores[], int *numUtilizadores) {
    
    
    
    if (*numUtilizadores >= MAX_UTILIZADORES ) {
        printf("Numero máximo de utilizadores atingido.\n");
        return;
    }

    Utilizador novoUtilizador;
   printf("Insira nome: ");
    scanf("%s", novoUtilizador.nome);
    printf("Insira uma password: ");
    scanf("%s", novoUtilizador.password);
    printf("Insira a idade");
    scanf("%d", novoUtilizador.nome);
    printf("Insira o nif:");
    scanf("%s", novoUtilizador.nif);
    novoUtilizador.admin = 0;

    utilizadores[(*numUtilizadores)++] = novoUtilizador;
    printf("Registration successful.\n");
}

int loginUtilizador(Utilizador utilizadores[], int numUtilizadores, Utilizador utilizadorAtual) {
  

    for (int i = 0; i < numUtilizadores; i++) {
        if (strcmp(utilizadores[i].nome, utilizadorAtual.nome) == 0 && strcmp(utilizadores[i].password, utilizadorAtual.password) == 0) {
            return i;//manda a localização do utilizador atual no array
        }
    }

    return -1;
}

void criarEvento(Evento eventos[], int *numEventos) {
    if (*numEventos >= MAX_EVENTOS) {
        printf("Numero máximo de eventos atingido.\n");
        return;
    }
    
    Evento novoEvento;
    printf("Insira o nomo do evento: ");
    scanf("%s", novoEvento.nomeEv);
    printf("Insira a data do evento: ");
    scanf("%s", novoEvento.data);
    printf("Insira os detalhes do evento: ");
    scanf("%s", novoEvento.DetalhesEvento);
    printf("Insira o preco que pretende:");
    scanf("%d", novoEvento.preco);
   
    eventos[(*numEventos)++] = novoEvento;
    printf("Evento criado com sucesso.\n");
}

void editEvent(int eventIndex) {
    if (eventIndex < 0 || eventIndex >= numEvents) {
        printf("Invalid event index.\n");
        return;
    }

    printf("Enter new event name: ");
    scanf("%s", eventos[eventIndex].nomeEv);

    printf("Event edited successfully.\n");
}   

void changeEvent() {
    int eventIndex;
    printf("Enter event index: ");
    scanf("%d", &eventIndex);

    editEvent(eventIndex);
}

int main() {
    int choice;
    int loginuser = -1;

    Utilizador utilizadores[MAX_EVENTOS];
    Evento eventos[MAX_EVENTOS];
    int numUtilizadores = 0;
    int numEvents = 0;
    Utilizador utilizadorAtual;
    utilizadorAtual.admin = 0;
  

    while (1) {
        printf("\n--- Event Organizer Software ---\n");
        printf("1. Register\n");
        printf("2. Login\n");
        if (utilizadorAtual.admin)
        {
            printf("3. Create Event\n");
            printf("4. Edit Event\n");
            printf("5. Delete Event\n");
        }
    
        printf("6. Exit\n");
        printf("Enter your choice: ");
        scanf("%d", &choice);

        switch (choice) {
            case 1:
           
                registarUtilizador(utilizadores, &numUtilizadores);
                break;
            case 2: //meter dados aqui, e pedir em baixo
               printf("Enter username: ");
                scanf("%s", utilizadorAtual.nome);
                printf("Enter password: ");
                scanf("%s", utilizadorAtual.password);
                loginuser = loginUtilizador(utilizadores, numUtilizadores, utilizadorAtual);

                if (loginuser == -1)
                {
                    printf("Palavra passe ou Nome incorretos");
                }else{
                    utilizadorAtual = utilizadores[loginuser];//traz a localização do user atual
                    printf("Login bem sucedido");
                }
                
                break;
            case 3:
                if (loginuser  == -1) {
                    printf("Please login first.\n");
                } else {
                    if (utilizadorAtual.admin)  criarEvento();
                }
                break;
            case 4:
                if (loginuser== -1) {
                    printf("Please login first.\n");
                } else {
                    editEvent(loginuser);
                }
                break;
            case 5:
                if (loginuser == -1) {
                    printf("Please login first.\n");
                } else {
                    changeEvent();
                }
                break;
            case 6:
                printf("Exiting...\n");
                exit(0);
            default:
                printf("Invalid choice.\n");
        }
    }

    return 0;
}